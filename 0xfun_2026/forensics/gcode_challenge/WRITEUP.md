# GCode - Writeup

**Category:** Misc / Forensics
**Points:** -
**Flag:** `0xfun{this_monkey_has_a_flag}`

---

## Description

We are provided with a `3D.gcode` file of 37 MB (~1.16 million lines) generated with Cura for an Ultimaker S5 printer. The file contains the 3D printing instructions for a model that hides the flag.

## Analysis

### 1. Initial reconnaissance

Inspecting the GCode headers we find:

```
;GENERATOR.NAME:Cura_SteamEngine
;GENERATOR.VERSION:5.10.2
;TARGET_MACHINE.NAME:Ultimaker S5
;LAYER_COUNT:773
```

The file contains **773 print layers** and two meshes (3D objects):

- `model.stl` - The main model (a monkey, the classic Blender Suzanne)
- `flag.stl` - A separate object containing the flag engraved in relief

Additionally, each layer has different extrusion types:
- `WALL-OUTER` - Outer walls (visible contour)
- `WALL-INNER` - Inner walls
- `FILL` - Internal fill (infill)
- `SKIN` - Top/bottom surfaces
- `SKIRT` - Initial purge line

### 2. Extraction strategy

The key is that the flag text is **engraved in relief** on the `flag.stl` object. To read it we need to render a **front view (X-Z plane)** showing only the extrusion segments of that mesh.

### 3. GCode parsing

The GCode uses G0 (rapid movement without extrusion) and G1 (movement with extrusion) commands. The segments that actually deposit material are the `G1` commands with `E > 0` parameter.

The `solve.py` script filters by:
1. **Mesh:** only `flag.stl` (ignoring `model.stl`)
2. **Type:** only `WALL-OUTER` (outer contour, where the text relief is)
3. **Extrusion:** only `G1` movements with `E > 0`

This extracts **22,354 relevant segments**.

### 4. Front view rendering

The 3D segments are projected onto the **X-Z plane** (X horizontal, Z vertical upward), discarding the Y coordinate (depth). This produces a front view of the object where the letters appear as outlines.

To improve readability, the letters are filled column by column: for each pixel column, the black pixels (outline) are found and the space between them is filled.

### 5. Result

The resulting image (`flag_filled.png`, 6900x2580px) clearly shows the text in two lines:

```
0xfun{this_monkey
     _has_a_flag}
```

## Solution

```bash
python3 solve.py
# [+] WALL-OUTER segments from flag.stl: 22354
# [+] Outline saved: flag_outline.png (6900x2580)
# [+] Fill saved: flag_filled.png
# [+] Flag: 0xfun{this_monkey_has_a_flag}
```

The complete script is in `solve.py`.

## Flag

```
0xfun{this_monkey_has_a_flag}
```

## Notes

- The `model.stl` model is a monkey (Blender's Suzanne), which matches the flag
- The main difficulty is identifying that the text is in the separate `flag.stl` mesh and that you need to render the front X-Z projection filtering only the outer walls
- Using only `WALL-OUTER` eliminates noise from infill and inner walls, making the text much more readable
- The letter filling step (column-based flood-fill) significantly improves readability, since GCode only defines the outlines

## Files

- `3D.gcode` - Original challenge file (37 MB)
- `solve.py` - Solution script
- `flag_outline.png` - Front view with outlines only (generated by solve.py)
- `flag_filled.png` - Front view with filled letters (generated by solve.py)
